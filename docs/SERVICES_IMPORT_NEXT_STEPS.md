# Сервисы: импорт, архивы, проверка — план следующих шагов

Документ-самосборник идей и «быстрых побед» по доработке импорта сервисов, управлению архивами и генерации игр. С этого списка начнём в следующих итерациях.

Обновлено: 2025‑09‑07

## Импорт и метаданные

- Подтягивать `.ctf01d-service.yml`: id сервиса, `script_path`, зависимости; автозаполнение полей и валидация структуры архива.
- Импорт из GitHub Releases и GitLab; поддержка приватных репозиториев (PAT через ENV).
- «Re‑parse» без повторной загрузки: заново распарсить README/LICENSE/.yml и обновить метаданные.

## Архивы и безопасность

- Жёсткая проверка ZIP: защита от ZipSlip (path traversal), ограничение глубины и числа файлов, раннее завершение при zip‑bomb.
- Версионирование архивов без БД: `storage/services/<id>/manifest.json` с историей (время, размер, sha256, источник).
- Конфигурируемые лимиты через ENV: `ARCHIVE_MAX_BYTES`, таймауты, allow‑list доменов для загрузок.

## Проверка чекера

- Реальная проверка вместо заглушки: job, который распаковывает `checker.zip`, ищет `script_path`, запускает `--help`/dry‑run в изоляции (Docker/namespace), соблюдает таймауты.
- Логи проверки и статус: queued/running/ok/fail; кнопка «Показать лог проверки» на странице сервиса.

## Экспорт игры

- Подхватывать сохранённые `checker.zip` в экспорте: использовать реальные файлы чекеров вместо примеров.
- Предварительная валидация маппинга: предупреждать, если нет локального checker или отсутствует `script_path`.

## Фоновые задачи и настройки

- Перевести скачивание/перескачивание/проверку в фоновые jobs (`solid_queue`), с прогрессом и логами.
- Ретрай‑политика и rate‑limit на внешние запросы (exponential backoff).

## UI/UX

- На карточке сервиса: источник (GitHub URL), короткий сниппет README (1–2 строки), кнопка «Переимпортировать из GitHub».
- Индикатор актуальности локальных копий: «устарела» (если URL изменился или старше N дней).

## Безопасность и аудит

- Аудит‑лог действий: кто импортировал/перескачал/загрузил, суммы и источники.
- Allow‑list доменов для скачивания архивов (например, только github.com, gitlab.com).

## Быстрые победы (prioritized)

1) Экспорт игры с реальными `checker.zip` (без заглушек).
2) Валидация `.ctf01d-service.yml` + структура ZIP (service/checker, обязательные файлы).
3) Фоновые jobs для «Перескачать» и «Проверить чекер» с логами.

