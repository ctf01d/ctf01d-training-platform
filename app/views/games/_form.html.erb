<div class="card">
  <%= form_with(model: game, html: { class: 'form', multipart: true }) do |form| %>
    <% if game.errors.any? %>
      <div class="form-errors">
        <strong><%= pluralize(game.errors.count, "ошибка") %></strong>
        <ul>
          <% game.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :name %>
      <%= form.text_field :name %>
    </div>

    <div class="form-group">
      <%= form.label :organizer %>
      <%= form.text_field :organizer %>
    </div>

    <div class="form-group">
      <%= form.label :starts_at %>
      <%= form.datetime_field :starts_at %>
    </div>

    <div class="form-group">
      <%= form.label :ends_at %>
      <%= form.datetime_field :ends_at %>
    </div>

    <div class="form-group">
      <%= form.label :avatar_url, 'Логотип (URL)' %>
      <%= form.text_field :avatar_url %>
      <div class="muted" style="font-size:12px;">Можно загрузить файл или указать URL (http/https/data:image).</div>
      <%= form.file_field :avatar_upload, accept: 'image/*' %>
    </div>

    <div class="form-group">
      <%= form.label :site_url, 'Сайт' %>
      <%= form.text_field :site_url, placeholder: 'https://example.com' %>
    </div>

    <div class="form-group">
      <%= form.label :ctftime_url, 'CTFtime' %>
      <%= form.text_field :ctftime_url, placeholder: 'https://ctftime.org/event/…' %>
    </div>

    <h3>Окна планирования</h3>
    <div class="form-group">
      <%= form.label :registration_opens_at, 'Регистрация — с' %>
      <%= form.datetime_field :registration_opens_at %>
    </div>
    <div class="form-group">
      <%= form.label :registration_closes_at, 'Регистрация — до' %>
      <%= form.datetime_field :registration_closes_at %>
    </div>
    <div class="form-group">
      <%= form.label :scoreboard_opens_at, 'Scoreboard — с' %>
      <%= form.datetime_field :scoreboard_opens_at %>
    </div>
    <div class="form-group">
      <%= form.label :scoreboard_closes_at, 'Scoreboard — до' %>
      <%= form.datetime_field :scoreboard_closes_at %>
    </div>

    <div class="form-group">
      <%= form.label :service_ids, 'Сервисы соревнования' %>
      <div>
        <% Service.order(:name).each do |svc| %>
          <label style="display:block;">
            <%= check_box_tag 'game[service_ids][]', svc.id, form.object.service_ids.include?(svc.id), id: "game_service_#{svc.id}" %>
            <%= svc.name %>
          </label>
        <% end %>
        <%= hidden_field_tag 'game[service_ids][]', '' %>
      </div>
    </div>

    <div class="form-actions">
      <%= form.submit 'Сохранить', class: 'btn primary' %>
    </div>

    <h3>Доступ / Сети</h3>
    <div class="form-group">
      <%= form.label :vpn_url, 'VPN URL' %>
      <%= form.text_field :vpn_url, placeholder: 'https://vpn.example/connect' %>
    </div>
    <div class="form-group">
      <%= form.label :vpn_config_url, 'VPN Config URL' %>
      <%= form.text_field :vpn_config_url, placeholder: 'https://vpn.example/configs/game.ovpn' %>
    </div>
    <div class="form-group">
      <%= form.label :access_secret, 'Секрет/ключ' %>
      <%= form.text_field :access_secret, placeholder: 'секретная строка' %>
    </div>
    <div class="form-group">
      <%= form.label :access_instructions, 'Инструкции' %>
      <%= form.text_area :access_instructions, rows: 5, placeholder: "Подключитесь к VPN..." %>
    </div>
  <% end %>
</div>
