<div id="<%= dom_id service %>">
  <div style="display:flex; align-items:center; gap:10px;">
    <% url = service.avatar_url.to_s.strip %>
    <% if url.present? && (url.start_with?('http://', 'https://', '/') || url.start_with?('data:image')) %>
      <%= image_tag url, alt: service.name, class: 'avatar-image' %>
    <% else %>
      <% initial = service.name.to_s.first&.upcase || '?' %>
      <span class="avatar-circle" aria-label="avatar"><%= initial %></span>
    <% end %>
    <div>
      <strong><%= service.name %></strong>
      <% if service.public %>
        <span class="badge badge--green">public</span>
      <% else %>
        <span class="badge badge--gray">private</span>
      <% end %>
    </div>
  </div>

  <p style="margin: 6px 0 0 0;">
    <em><%= service.author %></em>
  </p>

  <div style="margin-top:8px;">
    <div><strong>Public description:</strong> <%= service.public_description %></div>
    <% if user_signed_in? && current_user.role == 'admin' %>
      <div style="margin-top:4px; color:#666;"><strong>Private:</strong> <%= service.private_description %></div>
    <% end %>
  </div>

  <div style="margin-top:8px;">
    <% if service.service_archive_url.present? %>
      <div>Service archive: <%= link_to service.service_archive_url, service.service_archive_url, target: '_blank', rel: 'noopener' %></div>
    <% end %>
    <% if service.checker_archive_url.present? %>
      <div>Checker archive: <%= link_to service.checker_archive_url, service.checker_archive_url, target: '_blank', rel: 'noopener' %></div>
    <% end %>
    <% if service.writeup_url.present? %>
      <div>Writeup: <%= link_to service.writeup_url, service.writeup_url, target: '_blank', rel: 'noopener' %></div>
    <% end %>
    <% if service.exploits_url.present? %>
      <div>Exploits: <%= link_to service.exploits_url, service.exploits_url, target: '_blank', rel: 'noopener' %></div>
    <% end %>
  </div>

  <% if user_signed_in? && current_user.role == 'admin' %>
    <div style="margin-top:8px;">
      <% if service.public %>
        <%= button_to 'Сделать приватным', toggle_public_service_path(service), method: :post %>
      <% else %>
        <%= button_to 'Сделать публичным', toggle_public_service_path(service), method: :post %>
      <% end %>
      <% if service.checker_archive_url.present? %>
        <%= button_to 'Проверить чекер', check_checker_service_path(service), method: :post, form: { style: 'display:inline' } %>
        <% if service.check_status.present? %>
          <% color = case service.check_status
                    when 'ok' then 'green'
                    when 'fail' then 'red'
                    when 'queued' then 'blue'
                    else 'gray' end %>
          <span class="badge" style="background:#<%= { 'green'=>'3a3', 'red':'c55', 'blue':'59c', 'gray':'999' }[color] %>; margin-left:8px;">checker: <%= service.check_status %></span>
        <% end %>
      <% end %>
    </div>
  <% end %>

</div>
