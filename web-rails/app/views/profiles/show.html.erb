<% content_for :title, 'Мой профиль' %>

<h1>Мой профиль</h1>

<div>
  <% if @user.avatar_url.present? %>
    <%= image_tag @user.avatar_url, alt: @user.display_name, class: 'avatar-image' %>
  <% else %>
    <% initial = @user.user_name.to_s.first&.upcase || '?' %>
    <span class="avatar-circle" aria-label="avatar"><%= initial %></span>
  <% end %>
</div>

<p><strong>Логин:</strong> <%= @user.user_name %></p>
<p><strong>Имя:</strong> <%= @user.display_name %></p>
<p><strong>Роль:</strong> <%= @user.role %></p>

<p>
  <%= link_to 'Редактировать', edit_profile_path %>
  |
  <%= link_to 'Мои команды', profile_path(anchor: 'my-teams') %>
</p>

<hr>
<h2 id="my-teams">Мои команды и роли</h2>
<% if @memberships.any? %>
  <table border="1" cellpadding="6" cellspacing="0">
    <tr>
      <th>Команда</th>
      <th>Роль</th>
      <th>Статус</th>
      <th>Действия</th>
    </tr>
    <% @memberships.each do |m| %>
      <tr>
        <td><%= link_to(m.team&.name || '—', m.team || teams_path) %></td>
        <td><%= m.role %></td>
        <td><%= m.status %></td>
        <td>
          <% if m.status == 'approved' %>
            <%= button_to 'Покинуть команду', team_membership_path(m), method: :delete, form: { style: 'display:inline', data: { turbo_confirm: 'Покинуть команду?' } } %>
          <% elsif m.status == 'pending' %>
            <%= button_to 'Отозвать заявку', team_membership_path(m), method: :delete, form: { style: 'display:inline', data: { turbo_confirm: 'Отозвать заявку?' } } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
<% else %>
  <p>Вы пока не состоите в командах.</p>
<% end %>
