<div id="<%= dom_id game %>">
  <div class="row">
    <% url = game.avatar_url.to_s.strip %>
    <% if url.present? && (url.start_with?('http://', 'https://', '/') || url.start_with?('data:image')) %>
      <%= image_tag url, alt: game.name, class: 'avatar-image' %>
    <% else %>
      <% initial = game.name.to_s.first&.upcase || '?' %>
      <span class="avatar-circle" aria-label="avatar"><%= initial %></span>
    <% end %>
    <div>
      <div style="display:flex; align-items:baseline; gap:8px;">
        <strong><%= game.name %></strong>
        <% st = game.status %>
        <% if st == :ongoing %>
          <span class="badge badge--green">идёт</span>
        <% elsif st == :upcoming %>
          <span class="badge badge--blue">скоро</span>
        <% elsif st == :past %>
          <span class="badge badge--gray">прошла</span>
        <% end %>
      </div>

      <p style="margin:4px 0 0 0; color:#555;">
        <%= game.organizer %>
      </p>

      <p style="margin:6px 0 0 0;">
        <strong>Период:</strong>
        <%= game.starts_at %> — <%= game.ends_at %>
      </p>

      <% if game.site_url.present? || game.ctftime_url.present? %>
        <p class="muted" style="margin:6px 0 0 0;">
          <% if game.site_url.present? %>
            <%= link_to 'Сайт', game.site_url, target: '_blank', rel: 'noopener' %>
          <% end %>
          <% if game.ctftime_url.present? %>
            <% if game.site_url.present? %> • <% end %>
            <%= link_to 'CTFtime', game.ctftime_url, target: '_blank', rel: 'noopener' %>
          <% end %>
        </p>
      <% end %>

      <% if game.services.any? %>
        <p style="margin:8px 0 0 0;">
          <strong>Сервисы:</strong>
          <%= game.services.order(:name).map { |s| link_to s.name, s }.join(' • ').html_safe %>
        </p>
      <% end %>
    </div>
  </div>
</div>
