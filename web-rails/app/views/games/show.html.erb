<%= render @game %>

<div style="margin-top:8px;">
  <% if user_signed_in? && current_user.role == 'admin' %>
    <%= link_to "Редактировать", edit_game_path(@game) %> |
  <% end %>
  <%= link_to "Назад к играм", games_path %> |
  <%= link_to "Таблица", scoreboard_path %>
  <% if user_signed_in? && current_user.role == 'admin' %>
    | <%= button_to "Destroy this game", @game, method: :delete, form: { style: 'display:inline' } %>
    | <%= link_to "Сервисы игры", manage_services_game_path(@game) %>
  <% end %>
</div>

<hr>
<h2>
  <% if @final %>Итоги (зафиксировано)<% else %>Результаты<% end %>
  <% if user_signed_in? && current_user.role == 'admin' %>
    <small style="font-weight:normal; margin-left:8px;">
      <% if @final %>
        <%= button_to 'Снять финализацию', unfinalize_game_path(@game), method: :delete, form: { style: 'display:inline' } %>
      <% else %>
        <%= button_to 'Зафиксировать итоги', finalize_game_path(@game), method: :post, form: { style: 'display:inline' } %>
      <% end %>
    </small>
  <% end %>
</h2>
<% if @results.any? %>
  <table border="1" cellpadding="6" cellspacing="0">
    <tr>
      <th>#</th>
      <th>Команда</th>
      <th>Очки</th>
    </tr>
    <% @results.each_with_index do |r, idx| %>
      <tr>
        <td><%= @final ? (r.position || idx + 1) : (idx + 1) %></td>
        <td><%= r.team&.name || '—' %></td>
        <td><%= r.score %></td>
      </tr>
    <% end %>
  </table>
<% else %>
  <p>Пока нет результатов.</p>
<% end %>

<% if user_signed_in? && current_user.role == 'admin' %>
  <p style="margin-top:8px;">
    <%= link_to 'Добавить результат', new_result_path(game_id: @game.id) %>
  </p>
<% end %>
